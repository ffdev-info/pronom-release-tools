<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>src.pronom_tools.pronom_tools API documentation</title>
<meta name="description" content="Tools to help with the PRONOM release pipeline …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>src.pronom_tools.pronom_tools</code></h1>
</header>
<section id="section-intro">
<p>Tools to help with the PRONOM release pipeline.</p>
<p>Summary outputs look as follows:</p>
<pre><code class="language-json">    {
    &quot;date&quot;: &quot;2023-11-23&quot;,
    &quot;latest_puid&quot;: &quot;fmt/1924&quot;,
    &quot;version&quot;: &quot;V116&quot;,
    &quot;sig_file&quot;: &quot;https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml&quot;,
    &quot;container_sig&quot;: &quot;https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml&quot;,
    &quot;xpuid_const&quot;: &quot;x-fmt/455&quot;,
    &quot;pronom_data&quot;: [
            {
                &quot;name&quot;: &quot;Broadcast WAVE 0 Generic&quot;,
                &quot;description&quot;: &quot;complete&quot;,
                &quot;signature&quot;: true,
                &quot;identifier&quot;: &quot;fmt/1&quot;
            },
            {
                &quot;name&quot;: &quot;Microsoft Word for Macintosh Document 3.0&quot;,
                &quot;description&quot;: &quot;complete&quot;,
                &quot;signature&quot;: true,
                &quot;identifier&quot;: &quot;x-fmt/1&quot;
            }
        ]
    }
</code></pre>
<p>For each PRONOM record <code>container signautre</code> is optional, if either
<code>signature</code> or <code>container_signature</code> is <code>True</code> the record is considered
to have a signature for identification.</p>
<p>Descriptions have the following statuses:</p>
<pre><code class="language-python">    DEPRECATED: Final[str] = &quot;deprecated&quot;
    OUTLINE: Final[str] = &quot;outline&quot;
    COMPLETE: Final[str] = &quot;complete&quot;
</code></pre>
<p>s
Assumption: Container signature file appears online before the release
notes. If it doesn't then this information will be out of sync from
one another.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Tools to help with the PRONOM release pipeline.

Summary outputs look as follows:

```json
    {
    &#34;date&#34;: &#34;2023-11-23&#34;,
    &#34;latest_puid&#34;: &#34;fmt/1924&#34;,
    &#34;version&#34;: &#34;V116&#34;,
    &#34;sig_file&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml&#34;,
    &#34;container_sig&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml&#34;,
    &#34;xpuid_const&#34;: &#34;x-fmt/455&#34;,
    &#34;pronom_data&#34;: [
            {
                &#34;name&#34;: &#34;Broadcast WAVE 0 Generic&#34;,
                &#34;description&#34;: &#34;complete&#34;,
                &#34;signature&#34;: true,
                &#34;identifier&#34;: &#34;fmt/1&#34;
            },
            {
                &#34;name&#34;: &#34;Microsoft Word for Macintosh Document 3.0&#34;,
                &#34;description&#34;: &#34;complete&#34;,
                &#34;signature&#34;: true,
                &#34;identifier&#34;: &#34;x-fmt/1&#34;
            }
        ]
    }
```

For each PRONOM record `container signautre` is optional, if either
`signature` or `container_signature` is `True` the record is considered
to have a signature for identification.

Descriptions have the following statuses:

```python
    DEPRECATED: Final[str] = &#34;deprecated&#34;
    OUTLINE: Final[str] = &#34;outline&#34;
    COMPLETE: Final[str] = &#34;complete&#34;
```
s
Assumption: Container signature file appears online before the release
notes. If it doesn&#39;t then this information will be out of sync from
one another.
&#34;&#34;&#34;

import argparse
import asyncio
import hashlib
import json
import logging
import os
import re
import sys
import time
import xml.etree.ElementTree as etree
from dataclasses import asdict, dataclass
from datetime import datetime
from pathlib import Path
from typing import Final, Union

import requests
from dotenv import load_dotenv

from .version import get_version

try:
    from src.pronom_export.pronom_xml_export import export_pronom_data
    from src.pronom_summary.pronom_summary import parse_pronom
except ModuleNotFoundError:
    from pronom_export.pronom_xml_export import export_pronom_data
    from pronom_summary.pronom_summary import parse_pronom


ENV_FILE: Final[str] = &#34;pronom.env&#34;

load_dotenv(ENV_FILE, verbose=True)

# Set up logging.
logging.basicConfig(
    format=&#34;%(asctime)-15s %(levelname)s :: %(filename)s:%(lineno)s:%(funcName)s() :: %(message)s&#34;,  # noqa: E501
    datefmt=&#34;%Y-%m-%d %H:%M:%S&#34;,
    level=&#34;INFO&#34;,
    handlers=[
        logging.StreamHandler(),
    ],
)

# Format logs using UTC time.
logging.Formatter.converter = time.gmtime


logger = logging.getLogger(__name__)


RELEASE_NOTE_URL: Final[
    str
] = &#34;https://www.nationalarchives.gov.uk/aboutapps/pronom/release-notes.xml&#34;


USER_AGENT: Final[str] = &#34;pronom-tools/0.0.0&#34;


class PronomToolsException(Exception):
    &#34;&#34;&#34;Exception to raise if there&#39;s an error in the workflow.&#34;&#34;&#34;


CDN_BASE: Final[str] = &#34;https://cdn.nationalarchives.gov.uk/documents/&#34;
RELEASE_ARCHIVE = (
    &#34;https://www.nationalarchives.gov.uk/aboutapps/pronom/droid-signature-files.htm&#34;
)
CONTAINER_UPDATE_URL: Final[
    str
] = &#34;https://www.nationalarchives.gov.uk/pronom/container-signature.xml&#34;


@dataclass
class ReleaseSummary:
    &#34;&#34;&#34;Release summary object.&#34;&#34;&#34;

    date: str
    latest_puid: str
    version: str
    release_notes: str
    sig_file: str = &#34;&#34;
    container_sig: str = &#34;&#34;
    xpuid_const: str = &#34;x-fmt/455&#34;

    @staticmethod
    def _get_container_formatted_date(date: str):
        &#34;&#34;&#34;Return a date formatted to container-signature-file
        specifications.
        &#34;&#34;&#34;
        date_format = &#34;%a, %d %b %Y %H:%M:%S GMT&#34;
        date_obj = datetime.strptime(date, date_format)
        return datetime.strftime(date_obj, &#34;%Y%m%d&#34;)

    def _get_container_date(self):
        &#34;&#34;&#34;Get the latest container signature file date from the
        canonical update location. Last-modified-date is used to set
        this in DROID itself.
        &#34;&#34;&#34;
        http_headers = requests.head(
            CONTAINER_UPDATE_URL, timeout=30, headers=make_headers()
        )
        if not http_headers.status_code == 200:
            raise PronomToolsException(&#34;error reading release headers&#34;)
        http_last_modified_date = http_headers.headers.get(&#34;Last-modified&#34;)
        http_date = self._get_container_formatted_date(http_last_modified_date)
        return http_date

    def make_sig_file_url(self) -&gt; str:
        &#34;&#34;&#34;Construct a URL to the standard signature file for the given
        release summary.

        Example: `https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml`
        &#34;&#34;&#34;
        file_name = f&#34;{CDN_BASE}DROID_SignatureFile_V{self.version.lower().replace(&#39;v&#39;, &#39;&#39;)}.xml&#34;
        self.sig_file = file_name
        return file_name

    def make_container_sig_file_url(self) -&gt; str:
        &#34;&#34;&#34;Construct a URL to the container signature file for the
        given release summary.

        Example: `https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml`
        &#34;&#34;&#34;
        file_name = f&#34;{CDN_BASE}container-signature-{self._get_container_date()}.xml&#34;
        self.container_sig = file_name
        return file_name

    def get_container_name(self) -&gt; str:
        &#34;&#34;&#34;Return just the container signature file name.&#34;&#34;&#34;
        return self.container_sig.replace(CDN_BASE, &#34;&#34;)


def download_container(rel: ReleaseSummary) -&gt; str:
    &#34;&#34;&#34;Download a container signature file and return the signature file
    name for use in later functions.

    Example release summary:

    ```json
        {
            &#34;date&#34;: &#34;2023-11-23&#34;,
            &#34;puid&#34;: &#34;fmt/1924&#34;,
            &#34;version&#34;: &#34;V116&#34;,
            &#34;sig_file&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml&#34;,
            &#34;container_sig&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml&#34;
        }
    ```
    &#34;&#34;&#34;
    res = requests.get(rel.container_sig, timeout=30)
    file_name = rel.container_sig.split(CDN_BASE, 1)[1]
    with open(file_name, &#34;w&#34;, encoding=&#34;utf-8&#34;) as sig_file:
        sig_file.write(res.text)
    return file_name


def download_standard(rel: ReleaseSummary) -&gt; str:
    &#34;&#34;&#34;Download a standard signature file and return the signature file
    name for use in later functions.

    Example release summary:

    ```json
        {
            &#34;date&#34;: &#34;2023-11-23&#34;,
            &#34;puid&#34;: &#34;fmt/1924&#34;,
            &#34;version&#34;: &#34;V116&#34;,
            &#34;sig_file&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml&#34;,
            &#34;container_sig&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml&#34;
        }
    ```
    &#34;&#34;&#34;
    res = requests.get(rel.sig_file, timeout=30)
    file_name = rel.sig_file.split(CDN_BASE, 1)[1]
    with open(file_name, &#34;w&#34;, encoding=&#34;utf-8&#34;) as sig_file:
        sig_file.write(res.text)
    return file_name


def perform_export(max_puid: int):
    &#34;&#34;&#34;Export PRONOM xml records.&#34;&#34;&#34;
    export_pronom_data(fmt_range=max_puid + 1)


def make_headers() -&gt; dict:
    &#34;&#34;&#34;Create a HTTP header object for the different http requests
    in this script.
    &#34;&#34;&#34;
    return {&#34;user-agent&#34;: USER_AGENT}


def replace_day_suffix(day: str):
    &#34;&#34;&#34;Replace suffixes in day strings, e.g. 2nd, 3rd.

    Source: https://stackoverflow.com/a/21496318
    &#34;&#34;&#34;
    return re.sub(r&#34;(\d)(st|nd|rd|th)&#34;, r&#34;\1&#34;, day)  # noqa, codespell


def parse_signature_file_string(sig_file: str) -&gt; str:
    &#34;&#34;&#34;Parse the signature file string and return a version number.

    Examples:

        * DROID_SignatureFile_V114.xml
        * DROID_SignatureFile_V112.xml
        * DROID_SignatureFile_V111.xml
        * DROID_SignatureFile_V110.xml
        * DROID_SignatureFile_V109.xml

    &#34;&#34;&#34;
    return sig_file.replace(&#34;DROID_SignatureFile_&#34;, &#34;&#34;).replace(&#34;.xml&#34;, &#34;&#34;)


def parse_release_date(date: str) -&gt; str:
    &#34;&#34;&#34;Parse PRONOM release dates.&#34;&#34;&#34;
    date_str = replace_day_suffix(date.strip())
    date_format = &#34;%d %B %Y&#34;
    date_obj = datetime.strptime(date_str, date_format)
    return str(date_obj.date())


def parse_newest_record_id(records: etree.Element) -&gt; str:
    &#34;&#34;&#34;Retrieve the newest record identifier from the signature
    file.
    &#34;&#34;&#34;
    formats = records.findall(&#34;format&#34;)
    return f&#34;fmt/{formats[len(formats) - 1].find(&#39;puid&#39;).text}&#34;


def parse_http_date(date: str) -&gt; datetime:
    &#34;&#34;&#34;Parse the HTTP dates from the release notes.&#34;&#34;&#34;
    date_format = &#34;%a, %d %b %Y %H:%M:%S GMT&#34;
    date_obj = datetime.strptime(date, date_format)
    return date_obj


def parse_release_xml(release_xml: str) -&gt; (str, str, str):
    &#34;&#34;&#34;Parse the PRONOM release notes XML.

    We need three pieces of information from here, the release date and
    the latest PRONOM record identifier and the version of the signature
    file.
    &#34;&#34;&#34;
    root = etree.fromstring(release_xml.strip())
    # Most recent release will always be the first in the Release Note XML.
    latest = root.find(&#34;release_note&#34;)
    date = latest.find(&#34;release_date&#34;)
    release_outline = latest.find(&#34;release_outline&#34;)
    signature_file_name = latest.find(&#34;signature_filename&#34;)
    release_date = parse_release_date(date.text)
    newest_record = parse_newest_record_id(release_outline)
    signature_version = parse_signature_file_string(signature_file_name.text)
    summary = ReleaseSummary(
        release_date,
        newest_record,
        signature_version,
        RELEASE_NOTE_URL,
    )
    summary.make_sig_file_url()
    summary.make_container_sig_file_url()
    return summary


def check_release_headers() -&gt; (bool, datetime):
    &#34;&#34;&#34;Check the HTTP headers of the release note to see if there is
    a newer date than we have recorded.&#34;&#34;&#34;
    http_headers = requests.head(RELEASE_NOTE_URL, timeout=30, headers=make_headers())
    if not http_headers.status_code == 200:
        raise PronomToolsException(&#34;error reading release headers&#34;)
    http_last_modified_date = http_headers.headers.get(&#34;Last-modified&#34;)
    http_date = parse_http_date(http_last_modified_date)
    return (http_date.date() == datetime.now().date(), http_date)


def check_for_release() -&gt; Union[None | ReleaseSummary]:
    &#34;&#34;&#34;Check for a new release of PRONOM.&#34;&#34;&#34;
    today, http_date = check_release_headers()
    if not today:
        logger.info(
            &#34;last updated &#39;%s&#39; is not today skipping release check&#34;, http_date.date()
        )
        return None
    resp = requests.get(RELEASE_NOTE_URL, timeout=30, headers=make_headers())
    return parse_release_xml(resp.text)


def check_existing() -&gt; Union[None | ReleaseSummary]:
    &#34;&#34;&#34;Return information about the existing pronom release.&#34;&#34;&#34;
    resp = requests.get(RELEASE_NOTE_URL, timeout=30, headers=make_headers())
    return parse_release_xml(resp.text)


def _dump_rel(rel: ReleaseSummary) -&gt; str:
    &#34;&#34;&#34;Convenience function to enable printing of release information
    as a dictionary.
    &#34;&#34;&#34;
    return json.dumps(asdict(rel), indent=2)


async def get_summary(clean: bool = False) -&gt; dict:
    &#34;&#34;&#34;Perform the get summary dance.&#34;&#34;&#34;
    rel = check_existing()
    max_puid = int(rel.latest_puid.lower().replace(&#34;fmt/&#34;, &#34;&#34;))
    if not Path(&#34;pronom-export&#34;).exists() or clean:
        perform_export(max_puid)
    sig_file = download_container(rel)
    res = await parse_pronom(&#34;pronom-export&#34;, sig_file)
    rel_augmented = asdict(rel)
    rel_augmented[&#34;pronom_data&#34;] = res
    return rel_augmented


async def store_summary():
    &#34;&#34;&#34;Store the PRONOM summary in the database.&#34;&#34;&#34;
    summary = await get_summary()
    store_pronom_summary(summary)


def _get_auth():
    &#34;&#34;&#34;Retrieve the authentication information from the environment.&#34;&#34;&#34;
    system_pass = None
    try:
        system_pass = os.environ[&#34;SERVER_AUTH&#34;]
    except KeyError as err:
        logging.error(&#34;environment needs configuring: %s&#34;, err)
        sys.exit(1)
    digest = hashlib.sha256()
    digest.update(system_pass.strip().encode())
    return digest.hexdigest()


def _get_api_addr():
    &#34;&#34;&#34;Get the address of the API server.&#34;&#34;&#34;
    server_addr = &#34;&#34;
    try:
        server_addr = os.environ[&#34;SERVER_ADDR&#34;]
    except KeyError as err:
        logging.error(&#34;environment needs configuring: %s&#34;, err)
        sys.exit(1)
    return server_addr


def store_pronom_summary(data: str):
    &#34;&#34;&#34;Store the PRONOM summary.&#34;&#34;&#34;
    headers = {}
    headers[&#34;auth&#34;] = _get_auth()
    server_addr = _get_api_addr()
    try:
        resp = requests.put(
            f&#34;{server_addr}/pronom_summary&#34;,
            data=json.dumps(data),
            headers=headers,
            timeout=30,
        )
        if resp.status_code != 200:
            logger.error(&#34;error storing PRONOM data: %s&#34;, resp)
            sys.exit(1)
    except requests.exceptions.ConnectionError as err:
        logger.error(&#34;unable to connect to database: %s&#34;, err)
        sys.exit(1)
    logger.info(&#34;PRONOM data stored&#34;)


async def pronom_tools():
    &#34;&#34;&#34;Run the PRONOM tooling.&#34;&#34;&#34;
    parser = argparse.ArgumentParser(
        prog=&#34;PRONOM tools&#34;,
        description=&#34;Provides helper functions for PRONOM releases&#34;,
        epilog=&#34;for more information visit https://ffdev.info/&#34;,
    )

    parser.add_argument(
        &#34;--new-release&#34;,
        &#34;-n&#34;,
        help=&#34;check whether there was a new PRONOM release&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--check-existing&#34;,
        &#34;-e&#34;,
        help=&#34;return information about the existing pronom release&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--summary&#34;,
        &#34;-s&#34;,
        help=&#34;summarize existing PRONOM data&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--store&#34;,
        &#34;-st&#34;,
        help=&#34;store existing PRONOM summary (ensure that an existing pronom-stats server is running)&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--clean-and-summary&#34;,
        &#34;-c&#34;,
        help=&#34;download and output any existing PRONOM data (deletes existing `pronom-export` folder)&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--download-container&#34;,
        &#34;-dc&#34;,
        help=&#34;download container signature file&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--download-signature&#34;,
        &#34;-ds&#34;,
        help=&#34;download standard signature file&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--version&#34;,
        &#34;-v&#34;,
        help=&#34;return version information&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    args = parser.parse_args()

    if args.new_release:
        rel = check_for_release()
        if not rel:
            sys.exit(1)
        print(_dump_rel(rel))

    if args.check_existing:
        rel = check_existing()
        print(_dump_rel(rel))
        sys.exit()

    if args.version:
        print(get_version())
        sys.exit()

    if args.summary or args.clean_and_summary:
        res = await get_summary(args.clean_and_summary)
        print(json.dumps(res, indent=2))
        sys.exit()

    if args.store:
        res = await store_summary()
        sys.exit()

    if args.download_container:
        rel = check_existing()
        sig_file = download_container(rel)
        print(&#34;container sig output to:&#34;, Path(sig_file).resolve())
        sys.exit()

    if args.download_signature:
        rel = check_existing()
        sig_file = download_standard(rel)
        print(&#34;container sig output to:&#34;, Path(sig_file).resolve())
        sys.exit()

    parser.print_help()


def main() -&gt; None:
    &#34;&#34;&#34;Primary entry point for this script.&#34;&#34;&#34;
    asyncio.run(pronom_tools())


if __name__ == &#34;__main__&#34;:
    main()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="src.pronom_tools.pronom_tools.check_existing"><code class="name flex">
<span>def <span class="ident">check_existing</span></span>(<span>) ‑> Optional[None]</span>
</code></dt>
<dd>
<div class="desc"><p>Return information about the existing pronom release.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_existing() -&gt; Union[None | ReleaseSummary]:
    &#34;&#34;&#34;Return information about the existing pronom release.&#34;&#34;&#34;
    resp = requests.get(RELEASE_NOTE_URL, timeout=30, headers=make_headers())
    return parse_release_xml(resp.text)</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.check_for_release"><code class="name flex">
<span>def <span class="ident">check_for_release</span></span>(<span>) ‑> Optional[None]</span>
</code></dt>
<dd>
<div class="desc"><p>Check for a new release of PRONOM.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_for_release() -&gt; Union[None | ReleaseSummary]:
    &#34;&#34;&#34;Check for a new release of PRONOM.&#34;&#34;&#34;
    today, http_date = check_release_headers()
    if not today:
        logger.info(
            &#34;last updated &#39;%s&#39; is not today skipping release check&#34;, http_date.date()
        )
        return None
    resp = requests.get(RELEASE_NOTE_URL, timeout=30, headers=make_headers())
    return parse_release_xml(resp.text)</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.check_release_headers"><code class="name flex">
<span>def <span class="ident">check_release_headers</span></span>(<span>) ‑> (<class 'bool'>, <class 'datetime.datetime'>)</span>
</code></dt>
<dd>
<div class="desc"><p>Check the HTTP headers of the release note to see if there is
a newer date than we have recorded.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_release_headers() -&gt; (bool, datetime):
    &#34;&#34;&#34;Check the HTTP headers of the release note to see if there is
    a newer date than we have recorded.&#34;&#34;&#34;
    http_headers = requests.head(RELEASE_NOTE_URL, timeout=30, headers=make_headers())
    if not http_headers.status_code == 200:
        raise PronomToolsException(&#34;error reading release headers&#34;)
    http_last_modified_date = http_headers.headers.get(&#34;Last-modified&#34;)
    http_date = parse_http_date(http_last_modified_date)
    return (http_date.date() == datetime.now().date(), http_date)</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.download_container"><code class="name flex">
<span>def <span class="ident">download_container</span></span>(<span>rel: <a title="src.pronom_tools.pronom_tools.ReleaseSummary" href="#src.pronom_tools.pronom_tools.ReleaseSummary">ReleaseSummary</a>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Download a container signature file and return the signature file
name for use in later functions.</p>
<p>Example release summary:</p>
<pre><code class="language-json">    {
        &quot;date&quot;: &quot;2023-11-23&quot;,
        &quot;puid&quot;: &quot;fmt/1924&quot;,
        &quot;version&quot;: &quot;V116&quot;,
        &quot;sig_file&quot;: &quot;https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml&quot;,
        &quot;container_sig&quot;: &quot;https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml&quot;
    }
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def download_container(rel: ReleaseSummary) -&gt; str:
    &#34;&#34;&#34;Download a container signature file and return the signature file
    name for use in later functions.

    Example release summary:

    ```json
        {
            &#34;date&#34;: &#34;2023-11-23&#34;,
            &#34;puid&#34;: &#34;fmt/1924&#34;,
            &#34;version&#34;: &#34;V116&#34;,
            &#34;sig_file&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml&#34;,
            &#34;container_sig&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml&#34;
        }
    ```
    &#34;&#34;&#34;
    res = requests.get(rel.container_sig, timeout=30)
    file_name = rel.container_sig.split(CDN_BASE, 1)[1]
    with open(file_name, &#34;w&#34;, encoding=&#34;utf-8&#34;) as sig_file:
        sig_file.write(res.text)
    return file_name</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.download_standard"><code class="name flex">
<span>def <span class="ident">download_standard</span></span>(<span>rel: <a title="src.pronom_tools.pronom_tools.ReleaseSummary" href="#src.pronom_tools.pronom_tools.ReleaseSummary">ReleaseSummary</a>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Download a standard signature file and return the signature file
name for use in later functions.</p>
<p>Example release summary:</p>
<pre><code class="language-json">    {
        &quot;date&quot;: &quot;2023-11-23&quot;,
        &quot;puid&quot;: &quot;fmt/1924&quot;,
        &quot;version&quot;: &quot;V116&quot;,
        &quot;sig_file&quot;: &quot;https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml&quot;,
        &quot;container_sig&quot;: &quot;https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml&quot;
    }
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def download_standard(rel: ReleaseSummary) -&gt; str:
    &#34;&#34;&#34;Download a standard signature file and return the signature file
    name for use in later functions.

    Example release summary:

    ```json
        {
            &#34;date&#34;: &#34;2023-11-23&#34;,
            &#34;puid&#34;: &#34;fmt/1924&#34;,
            &#34;version&#34;: &#34;V116&#34;,
            &#34;sig_file&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml&#34;,
            &#34;container_sig&#34;: &#34;https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml&#34;
        }
    ```
    &#34;&#34;&#34;
    res = requests.get(rel.sig_file, timeout=30)
    file_name = rel.sig_file.split(CDN_BASE, 1)[1]
    with open(file_name, &#34;w&#34;, encoding=&#34;utf-8&#34;) as sig_file:
        sig_file.write(res.text)
    return file_name</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.get_summary"><code class="name flex">
<span>async def <span class="ident">get_summary</span></span>(<span>clean: bool = False) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>Perform the get summary dance.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">async def get_summary(clean: bool = False) -&gt; dict:
    &#34;&#34;&#34;Perform the get summary dance.&#34;&#34;&#34;
    rel = check_existing()
    max_puid = int(rel.latest_puid.lower().replace(&#34;fmt/&#34;, &#34;&#34;))
    if not Path(&#34;pronom-export&#34;).exists() or clean:
        perform_export(max_puid)
    sig_file = download_container(rel)
    res = await parse_pronom(&#34;pronom-export&#34;, sig_file)
    rel_augmented = asdict(rel)
    rel_augmented[&#34;pronom_data&#34;] = res
    return rel_augmented</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Primary entry point for this script.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main() -&gt; None:
    &#34;&#34;&#34;Primary entry point for this script.&#34;&#34;&#34;
    asyncio.run(pronom_tools())</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.make_headers"><code class="name flex">
<span>def <span class="ident">make_headers</span></span>(<span>) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>Create a HTTP header object for the different http requests
in this script.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_headers() -&gt; dict:
    &#34;&#34;&#34;Create a HTTP header object for the different http requests
    in this script.
    &#34;&#34;&#34;
    return {&#34;user-agent&#34;: USER_AGENT}</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.parse_http_date"><code class="name flex">
<span>def <span class="ident">parse_http_date</span></span>(<span>date: str) ‑> datetime.datetime</span>
</code></dt>
<dd>
<div class="desc"><p>Parse the HTTP dates from the release notes.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def parse_http_date(date: str) -&gt; datetime:
    &#34;&#34;&#34;Parse the HTTP dates from the release notes.&#34;&#34;&#34;
    date_format = &#34;%a, %d %b %Y %H:%M:%S GMT&#34;
    date_obj = datetime.strptime(date, date_format)
    return date_obj</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.parse_newest_record_id"><code class="name flex">
<span>def <span class="ident">parse_newest_record_id</span></span>(<span>records: xml.etree.ElementTree.Element) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Retrieve the newest record identifier from the signature
file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def parse_newest_record_id(records: etree.Element) -&gt; str:
    &#34;&#34;&#34;Retrieve the newest record identifier from the signature
    file.
    &#34;&#34;&#34;
    formats = records.findall(&#34;format&#34;)
    return f&#34;fmt/{formats[len(formats) - 1].find(&#39;puid&#39;).text}&#34;</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.parse_release_date"><code class="name flex">
<span>def <span class="ident">parse_release_date</span></span>(<span>date: str) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Parse PRONOM release dates.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def parse_release_date(date: str) -&gt; str:
    &#34;&#34;&#34;Parse PRONOM release dates.&#34;&#34;&#34;
    date_str = replace_day_suffix(date.strip())
    date_format = &#34;%d %B %Y&#34;
    date_obj = datetime.strptime(date_str, date_format)
    return str(date_obj.date())</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.parse_release_xml"><code class="name flex">
<span>def <span class="ident">parse_release_xml</span></span>(<span>release_xml: str) ‑> (<class 'str'>, <class 'str'>, <class 'str'>)</span>
</code></dt>
<dd>
<div class="desc"><p>Parse the PRONOM release notes XML.</p>
<p>We need three pieces of information from here, the release date and
the latest PRONOM record identifier and the version of the signature
file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def parse_release_xml(release_xml: str) -&gt; (str, str, str):
    &#34;&#34;&#34;Parse the PRONOM release notes XML.

    We need three pieces of information from here, the release date and
    the latest PRONOM record identifier and the version of the signature
    file.
    &#34;&#34;&#34;
    root = etree.fromstring(release_xml.strip())
    # Most recent release will always be the first in the Release Note XML.
    latest = root.find(&#34;release_note&#34;)
    date = latest.find(&#34;release_date&#34;)
    release_outline = latest.find(&#34;release_outline&#34;)
    signature_file_name = latest.find(&#34;signature_filename&#34;)
    release_date = parse_release_date(date.text)
    newest_record = parse_newest_record_id(release_outline)
    signature_version = parse_signature_file_string(signature_file_name.text)
    summary = ReleaseSummary(
        release_date,
        newest_record,
        signature_version,
        RELEASE_NOTE_URL,
    )
    summary.make_sig_file_url()
    summary.make_container_sig_file_url()
    return summary</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.parse_signature_file_string"><code class="name flex">
<span>def <span class="ident">parse_signature_file_string</span></span>(<span>sig_file: str) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Parse the signature file string and return a version number.</p>
<h2 id="examples">Examples</h2>
<ul>
<li>DROID_SignatureFile_V114.xml</li>
<li>DROID_SignatureFile_V112.xml</li>
<li>DROID_SignatureFile_V111.xml</li>
<li>DROID_SignatureFile_V110.xml</li>
<li>DROID_SignatureFile_V109.xml</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def parse_signature_file_string(sig_file: str) -&gt; str:
    &#34;&#34;&#34;Parse the signature file string and return a version number.

    Examples:

        * DROID_SignatureFile_V114.xml
        * DROID_SignatureFile_V112.xml
        * DROID_SignatureFile_V111.xml
        * DROID_SignatureFile_V110.xml
        * DROID_SignatureFile_V109.xml

    &#34;&#34;&#34;
    return sig_file.replace(&#34;DROID_SignatureFile_&#34;, &#34;&#34;).replace(&#34;.xml&#34;, &#34;&#34;)</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.perform_export"><code class="name flex">
<span>def <span class="ident">perform_export</span></span>(<span>max_puid: int)</span>
</code></dt>
<dd>
<div class="desc"><p>Export PRONOM xml records.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def perform_export(max_puid: int):
    &#34;&#34;&#34;Export PRONOM xml records.&#34;&#34;&#34;
    export_pronom_data(fmt_range=max_puid + 1)</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.pronom_tools"><code class="name flex">
<span>async def <span class="ident">pronom_tools</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Run the PRONOM tooling.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">async def pronom_tools():
    &#34;&#34;&#34;Run the PRONOM tooling.&#34;&#34;&#34;
    parser = argparse.ArgumentParser(
        prog=&#34;PRONOM tools&#34;,
        description=&#34;Provides helper functions for PRONOM releases&#34;,
        epilog=&#34;for more information visit https://ffdev.info/&#34;,
    )

    parser.add_argument(
        &#34;--new-release&#34;,
        &#34;-n&#34;,
        help=&#34;check whether there was a new PRONOM release&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--check-existing&#34;,
        &#34;-e&#34;,
        help=&#34;return information about the existing pronom release&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--summary&#34;,
        &#34;-s&#34;,
        help=&#34;summarize existing PRONOM data&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--store&#34;,
        &#34;-st&#34;,
        help=&#34;store existing PRONOM summary (ensure that an existing pronom-stats server is running)&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--clean-and-summary&#34;,
        &#34;-c&#34;,
        help=&#34;download and output any existing PRONOM data (deletes existing `pronom-export` folder)&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--download-container&#34;,
        &#34;-dc&#34;,
        help=&#34;download container signature file&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--download-signature&#34;,
        &#34;-ds&#34;,
        help=&#34;download standard signature file&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    parser.add_argument(
        &#34;--version&#34;,
        &#34;-v&#34;,
        help=&#34;return version information&#34;,
        required=False,
        action=&#34;store_true&#34;,
    )

    args = parser.parse_args()

    if args.new_release:
        rel = check_for_release()
        if not rel:
            sys.exit(1)
        print(_dump_rel(rel))

    if args.check_existing:
        rel = check_existing()
        print(_dump_rel(rel))
        sys.exit()

    if args.version:
        print(get_version())
        sys.exit()

    if args.summary or args.clean_and_summary:
        res = await get_summary(args.clean_and_summary)
        print(json.dumps(res, indent=2))
        sys.exit()

    if args.store:
        res = await store_summary()
        sys.exit()

    if args.download_container:
        rel = check_existing()
        sig_file = download_container(rel)
        print(&#34;container sig output to:&#34;, Path(sig_file).resolve())
        sys.exit()

    if args.download_signature:
        rel = check_existing()
        sig_file = download_standard(rel)
        print(&#34;container sig output to:&#34;, Path(sig_file).resolve())
        sys.exit()

    parser.print_help()</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.replace_day_suffix"><code class="name flex">
<span>def <span class="ident">replace_day_suffix</span></span>(<span>day: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Replace suffixes in day strings, e.g. 2nd, 3rd.</p>
<p>Source: <a href="https://stackoverflow.com/a/21496318">https://stackoverflow.com/a/21496318</a></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def replace_day_suffix(day: str):
    &#34;&#34;&#34;Replace suffixes in day strings, e.g. 2nd, 3rd.

    Source: https://stackoverflow.com/a/21496318
    &#34;&#34;&#34;
    return re.sub(r&#34;(\d)(st|nd|rd|th)&#34;, r&#34;\1&#34;, day)  # noqa, codespell</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.store_pronom_summary"><code class="name flex">
<span>def <span class="ident">store_pronom_summary</span></span>(<span>data: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Store the PRONOM summary.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def store_pronom_summary(data: str):
    &#34;&#34;&#34;Store the PRONOM summary.&#34;&#34;&#34;
    headers = {}
    headers[&#34;auth&#34;] = _get_auth()
    server_addr = _get_api_addr()
    try:
        resp = requests.put(
            f&#34;{server_addr}/pronom_summary&#34;,
            data=json.dumps(data),
            headers=headers,
            timeout=30,
        )
        if resp.status_code != 200:
            logger.error(&#34;error storing PRONOM data: %s&#34;, resp)
            sys.exit(1)
    except requests.exceptions.ConnectionError as err:
        logger.error(&#34;unable to connect to database: %s&#34;, err)
        sys.exit(1)
    logger.info(&#34;PRONOM data stored&#34;)</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.store_summary"><code class="name flex">
<span>async def <span class="ident">store_summary</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Store the PRONOM summary in the database.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">async def store_summary():
    &#34;&#34;&#34;Store the PRONOM summary in the database.&#34;&#34;&#34;
    summary = await get_summary()
    store_pronom_summary(summary)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="src.pronom_tools.pronom_tools.PronomToolsException"><code class="flex name class">
<span>class <span class="ident">PronomToolsException</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Exception to raise if there's an error in the workflow.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class PronomToolsException(Exception):
    &#34;&#34;&#34;Exception to raise if there&#39;s an error in the workflow.&#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary"><code class="flex name class">
<span>class <span class="ident">ReleaseSummary</span></span>
<span>(</span><span>date: str, latest_puid: str, version: str, release_notes: str, sig_file: str = '', container_sig: str = '', xpuid_const: str = 'x-fmt/455')</span>
</code></dt>
<dd>
<div class="desc"><p>Release summary object.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class ReleaseSummary:
    &#34;&#34;&#34;Release summary object.&#34;&#34;&#34;

    date: str
    latest_puid: str
    version: str
    release_notes: str
    sig_file: str = &#34;&#34;
    container_sig: str = &#34;&#34;
    xpuid_const: str = &#34;x-fmt/455&#34;

    @staticmethod
    def _get_container_formatted_date(date: str):
        &#34;&#34;&#34;Return a date formatted to container-signature-file
        specifications.
        &#34;&#34;&#34;
        date_format = &#34;%a, %d %b %Y %H:%M:%S GMT&#34;
        date_obj = datetime.strptime(date, date_format)
        return datetime.strftime(date_obj, &#34;%Y%m%d&#34;)

    def _get_container_date(self):
        &#34;&#34;&#34;Get the latest container signature file date from the
        canonical update location. Last-modified-date is used to set
        this in DROID itself.
        &#34;&#34;&#34;
        http_headers = requests.head(
            CONTAINER_UPDATE_URL, timeout=30, headers=make_headers()
        )
        if not http_headers.status_code == 200:
            raise PronomToolsException(&#34;error reading release headers&#34;)
        http_last_modified_date = http_headers.headers.get(&#34;Last-modified&#34;)
        http_date = self._get_container_formatted_date(http_last_modified_date)
        return http_date

    def make_sig_file_url(self) -&gt; str:
        &#34;&#34;&#34;Construct a URL to the standard signature file for the given
        release summary.

        Example: `https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml`
        &#34;&#34;&#34;
        file_name = f&#34;{CDN_BASE}DROID_SignatureFile_V{self.version.lower().replace(&#39;v&#39;, &#39;&#39;)}.xml&#34;
        self.sig_file = file_name
        return file_name

    def make_container_sig_file_url(self) -&gt; str:
        &#34;&#34;&#34;Construct a URL to the container signature file for the
        given release summary.

        Example: `https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml`
        &#34;&#34;&#34;
        file_name = f&#34;{CDN_BASE}container-signature-{self._get_container_date()}.xml&#34;
        self.container_sig = file_name
        return file_name

    def get_container_name(self) -&gt; str:
        &#34;&#34;&#34;Return just the container signature file name.&#34;&#34;&#34;
        return self.container_sig.replace(CDN_BASE, &#34;&#34;)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.container_sig"><code class="name">var <span class="ident">container_sig</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.date"><code class="name">var <span class="ident">date</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.latest_puid"><code class="name">var <span class="ident">latest_puid</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.release_notes"><code class="name">var <span class="ident">release_notes</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.sig_file"><code class="name">var <span class="ident">sig_file</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.version"><code class="name">var <span class="ident">version</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.xpuid_const"><code class="name">var <span class="ident">xpuid_const</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.get_container_name"><code class="name flex">
<span>def <span class="ident">get_container_name</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Return just the container signature file name.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_container_name(self) -&gt; str:
    &#34;&#34;&#34;Return just the container signature file name.&#34;&#34;&#34;
    return self.container_sig.replace(CDN_BASE, &#34;&#34;)</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.make_container_sig_file_url"><code class="name flex">
<span>def <span class="ident">make_container_sig_file_url</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Construct a URL to the container signature file for the
given release summary.</p>
<p>Example: <code>https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml</code></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_container_sig_file_url(self) -&gt; str:
    &#34;&#34;&#34;Construct a URL to the container signature file for the
    given release summary.

    Example: `https://cdn.nationalarchives.gov.uk/documents/container-signature-20231127.xml`
    &#34;&#34;&#34;
    file_name = f&#34;{CDN_BASE}container-signature-{self._get_container_date()}.xml&#34;
    self.container_sig = file_name
    return file_name</code></pre>
</details>
</dd>
<dt id="src.pronom_tools.pronom_tools.ReleaseSummary.make_sig_file_url"><code class="name flex">
<span>def <span class="ident">make_sig_file_url</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Construct a URL to the standard signature file for the given
release summary.</p>
<p>Example: <code>https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml</code></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_sig_file_url(self) -&gt; str:
    &#34;&#34;&#34;Construct a URL to the standard signature file for the given
    release summary.

    Example: `https://cdn.nationalarchives.gov.uk/documents/DROID_SignatureFile_V116.xml`
    &#34;&#34;&#34;
    file_name = f&#34;{CDN_BASE}DROID_SignatureFile_V{self.version.lower().replace(&#39;v&#39;, &#39;&#39;)}.xml&#34;
    self.sig_file = file_name
    return file_name</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="src.pronom_tools" href="index.html">src.pronom_tools</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="src.pronom_tools.pronom_tools.check_existing" href="#src.pronom_tools.pronom_tools.check_existing">check_existing</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.check_for_release" href="#src.pronom_tools.pronom_tools.check_for_release">check_for_release</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.check_release_headers" href="#src.pronom_tools.pronom_tools.check_release_headers">check_release_headers</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.download_container" href="#src.pronom_tools.pronom_tools.download_container">download_container</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.download_standard" href="#src.pronom_tools.pronom_tools.download_standard">download_standard</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.get_summary" href="#src.pronom_tools.pronom_tools.get_summary">get_summary</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.main" href="#src.pronom_tools.pronom_tools.main">main</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.make_headers" href="#src.pronom_tools.pronom_tools.make_headers">make_headers</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.parse_http_date" href="#src.pronom_tools.pronom_tools.parse_http_date">parse_http_date</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.parse_newest_record_id" href="#src.pronom_tools.pronom_tools.parse_newest_record_id">parse_newest_record_id</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.parse_release_date" href="#src.pronom_tools.pronom_tools.parse_release_date">parse_release_date</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.parse_release_xml" href="#src.pronom_tools.pronom_tools.parse_release_xml">parse_release_xml</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.parse_signature_file_string" href="#src.pronom_tools.pronom_tools.parse_signature_file_string">parse_signature_file_string</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.perform_export" href="#src.pronom_tools.pronom_tools.perform_export">perform_export</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.pronom_tools" href="#src.pronom_tools.pronom_tools.pronom_tools">pronom_tools</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.replace_day_suffix" href="#src.pronom_tools.pronom_tools.replace_day_suffix">replace_day_suffix</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.store_pronom_summary" href="#src.pronom_tools.pronom_tools.store_pronom_summary">store_pronom_summary</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.store_summary" href="#src.pronom_tools.pronom_tools.store_summary">store_summary</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="src.pronom_tools.pronom_tools.PronomToolsException" href="#src.pronom_tools.pronom_tools.PronomToolsException">PronomToolsException</a></code></h4>
</li>
<li>
<h4><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary" href="#src.pronom_tools.pronom_tools.ReleaseSummary">ReleaseSummary</a></code></h4>
<ul class="">
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.container_sig" href="#src.pronom_tools.pronom_tools.ReleaseSummary.container_sig">container_sig</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.date" href="#src.pronom_tools.pronom_tools.ReleaseSummary.date">date</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.get_container_name" href="#src.pronom_tools.pronom_tools.ReleaseSummary.get_container_name">get_container_name</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.latest_puid" href="#src.pronom_tools.pronom_tools.ReleaseSummary.latest_puid">latest_puid</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.make_container_sig_file_url" href="#src.pronom_tools.pronom_tools.ReleaseSummary.make_container_sig_file_url">make_container_sig_file_url</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.make_sig_file_url" href="#src.pronom_tools.pronom_tools.ReleaseSummary.make_sig_file_url">make_sig_file_url</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.release_notes" href="#src.pronom_tools.pronom_tools.ReleaseSummary.release_notes">release_notes</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.sig_file" href="#src.pronom_tools.pronom_tools.ReleaseSummary.sig_file">sig_file</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.version" href="#src.pronom_tools.pronom_tools.ReleaseSummary.version">version</a></code></li>
<li><code><a title="src.pronom_tools.pronom_tools.ReleaseSummary.xpuid_const" href="#src.pronom_tools.pronom_tools.ReleaseSummary.xpuid_const">xpuid_const</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>
